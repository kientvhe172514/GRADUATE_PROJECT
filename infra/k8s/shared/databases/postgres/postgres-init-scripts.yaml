apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-init-scripts
  namespace: infrastructure
data:
  01-init-databases.sql: |
    -- ============================================
    -- PostgreSQL Database Initialization
    -- ============================================
    -- Tạo tất cả databases cho các microservices
    -- ============================================
    
    -- Auth Service Database
    CREATE DATABASE "IAM";
    
    -- Attendance Service Database
    CREATE DATABASE attendance_db;
    
    -- Employee Service Database
    CREATE DATABASE employee_db;
    
    -- Leave Service Database
    CREATE DATABASE leave_db;
    
    -- Notification Service Database
    CREATE DATABASE notification_db;
    
    -- Reporting Service Database
    CREATE DATABASE reporting_db;
    
    -- Face Recognition Service Database
    CREATE DATABASE zentry;
    
    -- ============================================
    -- Enable Extensions for all databases
    -- ============================================
    
    -- IAM Database (Auth)
    \c "IAM";
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
    CREATE EXTENSION IF NOT EXISTS "pgcrypto";
    
    -- Attendance Database
    \c attendance_db;
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
    CREATE EXTENSION IF NOT EXISTS "pgcrypto";
    
    -- Employee Database
    \c employee_db;
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
    CREATE EXTENSION IF NOT EXISTS "pgcrypto";
    
    -- Leave Database
    \c leave_db;
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
    CREATE EXTENSION IF NOT EXISTS "pgcrypto";
    
    -- Notification Database
    \c notification_db;
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
    CREATE EXTENSION IF NOT EXISTS "pgcrypto";
    
    -- Reporting Database
    \c reporting_db;
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
    CREATE EXTENSION IF NOT EXISTS "pgcrypto";
    
    -- Face Recognition Database (with pgvector for AI)
    \c zentry;
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
    CREATE EXTENSION IF NOT EXISTS "pgcrypto";
    CREATE EXTENSION IF NOT EXISTS vector;
