{
  "info": {
    "name": "Auth Service - RBAC APIs",
    "description": "Complete API collection for Auth Service with Role-Based Access Control",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "auth-service-rbac-v1",
    "version": "1.0.0"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{ACCESS_TOKEN}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Auto-set BASE_URL if not exists",
          "if (!pm.environment.get('BASE_URL')) {",
          "    pm.environment.set('BASE_URL', 'http://localhost:3001/api/v1/auth');",
          "}"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "üîê Authentication",
      "item": [
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.environment.set('ACCESS_TOKEN', jsonData.data.access_token);",
                  "    pm.environment.set('REFRESH_TOKEN', jsonData.data.refresh_token);",
                  "    console.log('‚úÖ Tokens saved to environment');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@zentry.com\",\n  \"password\": \"Admin@123\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/login",
              "host": ["{{BASE_URL}}"],
              "path": ["login"]
            },
            "description": "Login with email and password. Returns access token and refresh token."
          }
        },
        {
          "name": "Get Current User",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/me",
              "host": ["{{BASE_URL}}"],
              "path": ["me"]
            },
            "description": "Get current authenticated user information"
          }
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.environment.set('ACCESS_TOKEN', jsonData.data.access_token);",
                  "    pm.environment.set('REFRESH_TOKEN', jsonData.data.refresh_token);",
                  "    console.log('‚úÖ Tokens refreshed');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refresh_token\": \"{{REFRESH_TOKEN}}\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/refresh",
              "host": ["{{BASE_URL}}"],
              "path": ["refresh"]
            },
            "description": "Refresh access token using refresh token"
          }
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refresh_token\": \"{{REFRESH_TOKEN}}\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/logout",
              "host": ["{{BASE_URL}}"],
              "path": ["logout"]
            },
            "description": "Logout and invalidate refresh token"
          }
        }
      ]
    },
    {
      "name": "üë• Role Management",
      "item": [
        {
          "name": "List All Roles",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/roles?page=1&limit=10&status=active",
              "host": ["{{BASE_URL}}"],
              "path": ["roles"],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "Page number"
                },
                {
                  "key": "limit",
                  "value": "10",
                  "description": "Items per page"
                },
                {
                  "key": "status",
                  "value": "active",
                  "description": "Filter by status (active/inactive)"
                }
              ]
            },
            "description": "Get paginated list of all roles"
          }
        },
        {
          "name": "Get Role Details",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/roles/2",
              "host": ["{{BASE_URL}}"],
              "path": ["roles", "2"]
            },
            "description": "Get role details including permissions"
          }
        },
        {
          "name": "Create Role",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"TEAM_LEAD\",\n  \"name\": \"Team Lead\",\n  \"description\": \"Team leader with limited management permissions\",\n  \"level\": 3,\n  \"is_system_role\": false\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/roles",
              "host": ["{{BASE_URL}}"],
              "path": ["roles"]
            },
            "description": "Create a new role"
          }
        },
        {
          "name": "Update Role",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Senior Team Lead\",\n  \"description\": \"Senior team leader with enhanced permissions\",\n  \"status\": \"active\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/roles/5",
              "host": ["{{BASE_URL}}"],
              "path": ["roles", "5"]
            },
            "description": "Update role information"
          }
        },
        {
          "name": "Delete Role",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/roles/5",
              "host": ["{{BASE_URL}}"],
              "path": ["roles", "5"]
            },
            "description": "Delete a role (cannot delete if in use)"
          }
        },
        {
          "name": "Assign Permissions to Role",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"permission_ids\": [1, 2, 3, 10, 11, 12, 20, 21]\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/roles/5/permissions",
              "host": ["{{BASE_URL}}"],
              "path": ["roles", "5", "permissions"]
            },
            "description": "Assign multiple permissions to a role"
          }
        },
        {
          "name": "Get Role Permissions",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/roles/5/permissions",
              "host": ["{{BASE_URL}}"],
              "path": ["roles", "5", "permissions"]
            },
            "description": "Get all permissions assigned to a role"
          }
        }
      ]
    },
    {
      "name": "üîë Permission Management",
      "item": [
        {
          "name": "List All Permissions",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/permissions?page=1&limit=20&status=active",
              "host": ["{{BASE_URL}}"],
              "path": ["permissions"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                },
                {
                  "key": "status",
                  "value": "active"
                }
              ]
            },
            "description": "Get paginated list of all permissions"
          }
        },
        {
          "name": "Get Permissions by Resource",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/permissions/by-resource/employee",
              "host": ["{{BASE_URL}}"],
              "path": ["permissions", "by-resource", "employee"]
            },
            "description": "Get all permissions for a specific resource"
          }
        },
        {
          "name": "Get Permission Details",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/permissions/10",
              "host": ["{{BASE_URL}}"],
              "path": ["permissions", "10"]
            },
            "description": "Get single permission details"
          }
        },
        {
          "name": "Create Permission",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"report.export.pdf\",\n  \"resource\": \"report\",\n  \"action\": \"export\",\n  \"scope\": \"pdf\",\n  \"description\": \"Export reports in PDF format\",\n  \"is_system_permission\": false\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/permissions",
              "host": ["{{BASE_URL}}"],
              "path": ["permissions"]
            },
            "description": "Create a new permission"
          }
        },
        {
          "name": "Update Permission",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"description\": \"Export detailed reports in PDF format with charts\",\n  \"status\": \"active\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/permissions/70",
              "host": ["{{BASE_URL}}"],
              "path": ["permissions", "70"]
            },
            "description": "Update permission (description and status only for system permissions)"
          }
        },
        {
          "name": "Delete Permission",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/permissions/70",
              "host": ["{{BASE_URL}}"],
              "path": ["permissions", "70"]
            },
            "description": "Delete a permission (cannot delete if in use)"
          }
        }
      ]
    },
    {
      "name": "üë§ Account Management",
      "item": [
        {
          "name": "Register Account",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"john.doe@company.com\",\n  \"password\": \"SecurePass@123\",\n  \"full_name\": \"John Doe\",\n  \"role\": \"EMPLOYEE\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/register",
              "host": ["{{BASE_URL}}"],
              "path": ["register"]
            },
            "description": "Create a new account (public endpoint)"
          }
        },
        {
          "name": "Change Password",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"old_password\": \"SecurePass@123\",\n  \"new_password\": \"NewSecurePass@456\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/change-password",
              "host": ["{{BASE_URL}}"],
              "path": ["change-password"]
            },
            "description": "Change current user's password"
          }
        },
        {
          "name": "Forgot Password",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"john.doe@company.com\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/forgot-password",
              "host": ["{{BASE_URL}}"],
              "path": ["forgot-password"]
            },
            "description": "Request password reset email (public endpoint)"
          }
        },
        {
          "name": "Reset Password",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"abc123def456ghi789\",\n  \"new_password\": \"BrandNewPass@789\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/reset-password",
              "host": ["{{BASE_URL}}"],
              "path": ["reset-password"]
            },
            "description": "Reset password with token from email (public endpoint)"
          }
        }
      ]
    },
    {
      "name": "üîß Admin",
      "item": [
        {
          "name": "List All Accounts",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/admin/accounts?page=1&limit=10&role=EMPLOYEE&status=active",
              "host": ["{{BASE_URL}}"],
              "path": ["admin", "accounts"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                },
                {
                  "key": "role",
                  "value": "EMPLOYEE",
                  "description": "Filter by role"
                },
                {
                  "key": "status",
                  "value": "active",
                  "description": "Filter by status"
                },
                {
                  "key": "search",
                  "value": "",
                  "description": "Search by email or name",
                  "disabled": true
                }
              ]
            },
            "description": "Get paginated list of all accounts (admin only)"
          }
        },
        {
          "name": "Get Account Details",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/admin/accounts/2",
              "host": ["{{BASE_URL}}"],
              "path": ["admin", "accounts", "2"]
            },
            "description": "Get detailed account information (admin only)"
          }
        },
        {
          "name": "Update Account Status",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"inactive\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/admin/accounts/2/status",
              "host": ["{{BASE_URL}}"],
              "path": ["admin", "accounts", "2", "status"]
            },
            "description": "Update account status (admin only)"
          }
        },
        {
          "name": "View Audit Logs",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/admin/audit-logs?page=1&limit=20&action=login",
              "host": ["{{BASE_URL}}"],
              "path": ["admin", "audit-logs"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                },
                {
                  "key": "action",
                  "value": "login",
                  "description": "Filter by action"
                },
                {
                  "key": "account_id",
                  "value": "",
                  "description": "Filter by account",
                  "disabled": true
                },
                {
                  "key": "start_date",
                  "value": "",
                  "description": "From date",
                  "disabled": true
                },
                {
                  "key": "end_date",
                  "value": "",
                  "description": "To date",
                  "disabled": true
                }
              ]
            },
            "description": "View system audit logs (admin only)"
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "BASE_URL",
      "value": "http://localhost:3001/api/v1/auth",
      "type": "string"
    },
    {
      "key": "ACCESS_TOKEN",
      "value": "",
      "type": "string"
    },
    {
      "key": "REFRESH_TOKEN",
      "value": "",
      "type": "string"
    }
  ]
}
